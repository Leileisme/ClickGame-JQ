<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>威力在哪?(會走的威力)</title>

  <!-- icon CSS -->
  <link rel="stylesheet" href="./CSS/all.min.css">

  <!-- 我的 CSS -->
  <!-- <link rel="stylesheet" href="./CSS/style.css"> -->
  <link rel="stylesheet" href="./CSS/copy01.css">

  <style>
    @font-face {
      font-family: 'Pixel';
      src: url(./CSS/Pixel.ttf);
    }

    @font-face {
      font-family: '俐方體11號';
      src: url(./CSS/Cubic_11_1.010_R.ttf);
    }
  </style>
</head>

<body>

  <div id="content">


    <div id="left">
      <div id="selectMap">選擇地圖</div>

      <div id="map">
        <img src="./image/map01.jpg" id="map_img">
        <input id="map_btn_L" value="←" type="button">
        <input id="map_btn_R" value="→" type="button">
      </div>

      <!-- 開始按鈕 -->
      <input id="btn" type="button" value="Start">

      <!-- <label id="#btn" for="starBtn">
      <div id="btn">Start</div>
    </label> -->

      <!-- <input type="button" id="starBtn"> -->

      <!-- 分數/時間 -->
      <div id="score"> 分　數：<span id="score_number">00</span> 　　分</div>
      <div id="time"> 餘時間：<span id="time_number">00</span> 　　秒</div>
      <!-- 工具 -->
      <div id="tool_content">
        <div class="tool" id="t1"><i class="fa-solid fa-magnifying-glass"></i></div>
        <div class="tool" id="t2"><i class="fa-solid fa-wand-sparkles"></i></div>
        <div class="tool" id="t3"><i class="fa-regular fa-circle-question"></i></div>


      </div>

      <div id="line"></div>
      <!-- 最高分 -->
      <!-- 切換簡單版/困難版的紀錄保持人 -->
      <div id="high">

        <!-- 這邊想切換 map 不同最高分 -->
        <span class="highScore">最高分：
          <span id="highScoreNumber_map01">00</span>
          <span id="highScoreNumber_map02">00</span>
          <span id="highScoreNumber_map03">00</span>
          分 /
          <span id="highName_map01">???</span>
          <span id="highName_map02">???</span>
          <span id="highName_map03">???</span>
        </span>



      </div>
    </div>


    <!-- 中間 -->
    <div id="middle_game">
      <!-- 倒數符號 -->
      <div id="number"></div>

      <!-- game_concent 的底圖 -->
      <img src="./image/WhereWilly03.png" id="game_img">
      <!-- <img src="./image/map01.jpg" id="game_img"> -->


      <!-- 遊戲區 -->
      <div id="game">
        <div id="gameBox0_role"></div>

        <div id="gameBox2">
          <!-- map01 -->
          <div id="gameBox2_map01">
            <img src="./image/map01_21.png" id="map01_21_img">
            <img src="./image/map01_22.png" id="map01_22_img">
            <img src="./image/map01_23.png" id="map01_23_img">
            <img src="./image/map01_24.png" id="map01_24_img">
          </div>

          <div id="gameBox2_role">
          </div>

          <!-- map02 -->


          <div id="gameBox1">
            <!-- mpa01 -->
            <div id="gameBox1_map01">
              <img src="./image/map01_1.png" id="map01_1_img">
            </div>
            <div id="gameBox1_role"></div>

            <!-- map02 -->

          </div>
        </div>


        <!-- <div class="willyBox"><img src="./image/Willy_02.png"></div> -->
      </div>
    </div>


    <div class="right">
      <div id="title">通緝角色</div>

      <!-- 1分角色 -->
      <div class="box">
        <input id="willy_btn_L" value="←" type="button">
        <input id="willy_btn_R" value="→" type="button">
        <img id="willy_img" src="./image/Willy_01.png">

        <div class="role_information">
          <span class="word">
            <span class="role_score_word_01"></span>
            <span id="role_score_01" class="role_score">1</span>
            <span class="role_score_word_02">分</span>
          </span>
        </div>

      </div>

      <!-- 5分角色  老人-->
      <div class="box">
        <img src="./image/old.png">

        <div class="role_information">
          <span class="word">
            <span class="role_score_word_01"></span>
            <span id="role_score_01" class="role_score">5</span>
            <span class="role_score_word_02">分</span>
          </span>
        </div>

      </div>

      <!-- 扣分角色 女生  -->
      <div class="box">
        <img src="./image/woman.png">

        <div class="role_information">
          <span class="word">
            <span class="role_score_word_01">-</span>
            <span id="role_score_01" class="role_score">1</span>
            <span class="role_score_word_02">分</span>
          </span>
        </div>

      </div>

      <!-- 狗狗 -->
      <div class="box">
        <img src="./image/willy_dog.png" id="willy_dog_big">

        <div class="role_information">
          <span class="word">
            <span class="role_score_word_01"></span>
            <span id="role_score_01" class="role_score">5</span>
            <span class="role_score_word_02">秒</span>
          </span>
        </div>



      </div>








    </div>
</body>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js'
  integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=='
  crossorigin='anonymous'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.all.min.js'
  integrity='sha512-zB7yJLSASiSevQmWCrQaq+z/f5zRIa884hwWgmK1oI3MfolIzKcpDtyfBsrGqUi/hMCObVwr/+SZTByOqh0zkQ=='
  crossorigin='anonymous'></script>

<script>


  let score = 0
  let time = 0
  let countdown_number = 3
  let high_map01 = {
    name: '???',
    score: '00'
  }

  let high_map02 = {
    name: '???',
    score: '00'
  }


  let high_map03 = {
    name: '???',
    score: '00'
  }

  let high_map = [
    {
      name: '???',
      score: '00'
    },
    {
      name: '???',
      score: '00'
    }, {
      name: '???',
      score: '00'
    },
  ]

  let map_btn = 1


  // 把保存在本地端的最高分叫出來
  if (map_btn === 1) {
    if (localStorage.highest_map01) {
      const data = JSON.parse(localStorage.highest_map01)
      high_map01.name = data.name
      high_map01.score = data.score
      $('#highName_map01').text(high_map01.name)
      $('#highScoreNumber_map01').text(high_map01.score)
    }
  }


  if (map_btn === 2) {
    if (localStorage.highest_map02) {
      const data = JSON.parse(localStorage.highest_map02)
      high_map02.name = data.name
      high_map02.score = data.score
      $('#highName_map02').text(high_map02.name)
      $('#highScoreNumber_map02').text(high_map02.score)
    }
  }

  if (map_btn === 3) {
    if (localStorage.highest_map01) {
      const data = JSON.parse(localStorage.highest_map03)
      high_map03.name = data.name
      high_map03.score = data.score
      $('#highName_map03').text(high_map03.name)
      $('#highScoreNumber_map03').text(high_map03.score)
    }
  }


  // if (localStorage.high) {
  //   const date = JSON.parse(localStorage.high)
  //   high.name = date.name
  //   high.score = date.score
  //   $('#humanH').text(high.name)
  //   $('#scoreH').text(high.score)
  // }


  // 觀看1分角色
  let willy_btn = 1
  $('#willy_btn_R').click(function () {
    if (willy_btn < 4) {
      willy_btn += 1
      $('#willy_img').attr('src', `./image/Willy_0${willy_btn}.png`)
    } else {
      return
    }
  })

  $('#willy_btn_L').click(function () {
    if (willy_btn > 1) {
      willy_btn -= 1
      $('#willy_img').attr('src', `./image/Willy_0${willy_btn}.png`)
    } else {
      return
    }
  })


  // 選擇地圖

  const highScoreNumber_map = [
    `#highScoreNumber_map01`,
    `#highScoreNumber_map02`,
    `#highScoreNumber_map03`
  ]

  const highName_map = [
    '#highName_map01',
    '#highName_map02',
    '#highName_map03',
  ]

  $('#map_btn_R').click(function () {
    if (map_btn < 3) {
      map_btn += 1
      $('#map_img').attr('src', `./image/map0${map_btn}.jpg`)

      highScoreNumber_map.forEach((el, index) => {
        if (map_btn === index + 1) {
          $(el).css('display', 'inline')
        } else {
          $(el).css('display', 'none')
        }
      })

      highName_map.forEach((el, index) => {
        if (map_btn === index + 1) {
          $(el).css('display', 'inline')
        } else {
          $(el).css('display', 'none')
        }
      })
    } else {
      return
    }
  })

  $('#map_btn_L').click(function () {
    if (map_btn > 1) {
      map_btn -= 1
      $('#map_img').attr('src', `./image/map0${map_btn}.jpg`)

      highScoreNumber_map.forEach((el, index) => {
        if (map_btn === index + 1) {
          $(el).css('display', 'inline')
        } else {
          $(el).css('display', 'none')
        }
      })

      highName_map.forEach((el, index) => {
        if (map_btn === index + 1) {
          $(el).css('display', 'inline')
        } else {
          $(el).css('display', 'none')
        }
      })
    } else {
      return
    }
  })


  // 這邊 個位數 如何置右?

  // function btnBoxClickEvent() {
  $('#btn').click(function () {
    // 初始畫面

    // why label input 無效?
    $(this).attr('disabled', true)



    $('#btn').css('backgroundColor', '#ccc')
    $('#btn').css('border', '3px solid #ddd')
    $('#btn').css('top', '450px')

    score = 0
    $('#score_number').text(score)
    time = 7
    $('#time_number').text(time)


    $('#map_btn_R').attr('disabled', true)
    $('#map_btn_L').attr('disabled', true)

    // 開始前3秒


    $('#game_img').attr('src', `./image/WhereWilly04.png`)
    $('#number').css('display', `block`)
    $('#number').css('fontSize', `350px`)
    $('#number').text('3')
    countdown_number = 3


    let countdown = setInterval(function () {
      countdown_number -= 1
      $('#number').text(`${countdown_number}`)
      if (countdown_number === 1) {
        $('#number').css('left', '430px')
      }
    }, 1000)

    setTimeout(() => {
      clearInterval(countdown)
    }, 2000)


    // 3秒後進入遊戲，在每秒產生 willy前，先放一些在圖上，免得跳出 willy 時很好找
    setTimeout(() => {
      $('#game_img').attr('src', `./image/map0${map_btn}.jpg`)
      $('#number').css('display', `none`)

      if (map_btn === 1) {
        $(`#gameBox1_map01`).css('display', 'block')
        $(`#gameBox2_map01`).css('display', 'block')
      }

      // $('#game').css('cursor', 'url(./image/cursor_black.png)')



      // 設定 willy 隨機出現，若超過 game 範圍則往內
      // 但為什麼百分比老師的不會超過框框?
      const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
      const overLeft = ['95%', '96%', '97%', '98%', '99%', '100%']

      // 隨機位置作為陣列
      let topAll = [
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
      ]

      let leftAll = [
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
        Math.round(Math.random() * 100) + '%',
      ]

      // 將每一個超出範圍的隨機位置，放回範圍內
      topAll.forEach((top, index) => {
        if (overTop.includes(top)) {
          topAll[index] = `calc(${top} - 68px)`
        }
      })


      leftAll.forEach((left, index) => {
        if (overTop.includes(top)) {
          topAll[index] = `calc(${left} - 30px)`
        }
      })


      // 隨出出現 willy 的圖
      const willyNumber = [
        Math.ceil(Math.random() * 4),
        Math.ceil(Math.random() * 4),
        Math.ceil(Math.random() * 4),
        Math.ceil(Math.random() * 4),
      ]

      //  隨機出現的地圖層
      const gameBoxNumber = [
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
        Math.floor(Math.random() * 3),
      ]
      // 產生 willy + woman 的陣列
      const willy01 = [0, 1, 2, 3]
      const womans = [0, 1, 2]


      willy01.forEach((theWilly, index) => {
        theWilly = $(`<div class="willyBox" style="top:${topAll[index]} ; left:${leftAll[index]};"><img src="./image/Willy_0${willyNumber[index]}.png" ></div>`)
        $(`#gameBox${gameBoxNumber[index]}_role`).append(theWilly)
      })

      // 產生扣分女人
      womans.forEach((woman, index) => {
        woman = $(`<div class="womanBox " style="top:${topAll[index + 5]} ; left:${leftAll[index + 5]};"><img src="./image/woman.png" ></div>`)
        $(`#gameBox${gameBoxNumber[index + 5]}_role`).append(woman)
      })

      // 產生老人
      const old = $(`<div class="oldBox" style="top:${topAll[12]} ; left:${leftAll[12]};"><img src="./image/old.png" ></div>`)
      $(`#gameBox${gameBoxNumber[12]}_role`).append(old)

      // 產生威力的狗
      const willy_dog = $(`<div class="dogBox" style="top:${topAll[11]} ; left:${leftAll[11]};"><img src="./image/willy_dog.png" ></div>`)
      $(`#gameBox${gameBoxNumber[11]}_role`).append(willy_dog)



      // 開始遊戲 為什麼老師示範是前面變數設為 let timer = 0 ?
      let begin = setInterval(() => {
        time--
        $('#time_number').text(time)

        // 符合條件時：最多8個 每秒產生的 willy
        const random_willy = Math.ceil(Math.random() * 10)
        if (random_willy > 5 && $('.willyBox').length < 8) {
          const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
          const overLeft = ['95%', '96%', '97%', '98%', '99%', '100%']
          let top = Math.round(Math.random() * 100) + '%'
          let left = Math.round(Math.random() * 100) + '%'

          const willyNumber = Math.ceil(Math.random() * 4)
          const gameBoxNumber = Math.floor(Math.random() * 3)

          if (overTop.includes(top)) {
            top = `calc(${top} - 68px)`
          }
          if (overLeft.includes(left)) {
            left = `calc(${left} - 30px)`
          }

          const willy01 = $(`<div class="willyBox" style="top:${top} ; left:${left};"><img src="./image/Willy_0${willyNumber}.png"></div>`)
          $(`#gameBox${gameBoxNumber}_role`).append(willy01)
        }


        // 符合條件時：最多3個  每秒產生的 woman
        const random_woman = Math.ceil(Math.random() * 10)

        if (random_woman > 5 && ('.womanBox').length < 3) {
          const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
          const overLeft = ['95%', '96%', '97%', '98%', '99%', '100%']
          let top = Math.round(Math.random() * 100) + '%'
          let left = Math.round(Math.random() * 100) + '%'
          const gameBoxNumber = Math.floor(Math.random() * 3)

          if (overTop.includes(top)) {
            top = `calc(${top} - 68px)`
          }
          if (overLeft.includes(left)) {
            left = `calc(${left} - 30px)`
          }

          const woman = $(`<div class="womanBox " style="top:${top} ; left:${left};"><img src="./image/woman.png" ></div>`)
          $(`#gameBox${gameBoxNumber}_role`).append(woman)
        }

        // 符合條件時：最多1個  每秒產生的  old

        const random_old = Math.ceil(Math.random() * 10)

        if (random_old > 9 && ('.womanBox').length < 2) {
          const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
          const overLeft = ['95%', '96%', '97%', '98%', '99%', '100%']
          let top = Math.round(Math.random() * 100) + '%'
          let left = Math.round(Math.random() * 100) + '%'
          const gameBoxNumber = Math.floor(Math.random() * 3)

          if (overTop.includes(top)) {
            top = `calc(${top} - 68px)`
          }
          if (overLeft.includes(left)) {
            left = `calc(${left} - 30px)`
          }

          const old = $(`<div class="dogBox" style="top:${top} ; left:${left};"><img src="./image/old.png" ></div>`)
          $(`#gameBox${gameBoxNumber}_role`).append(old)
        }


        // 符合條件時：最多2個  每秒產生的  dog 

        const random_dog = Math.ceil(Math.random() * 10)

        if (random_dog > 8 && ('.womanBox').length < 3) {
          const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
          const overLeft = ['95%', '96%', '97%', '98%', '99%', '100%']
          let top = Math.round(Math.random() * 100) + '%'
          let left = Math.round(Math.random() * 100) + '%'
          const gameBoxNumber = Math.floor(Math.random() * 3)

          if (overTop.includes(top)) {
            top = `calc(${top} - 68px)`
          }
          if (overLeft.includes(left)) {
            left = `calc(${left} - 30px)`
          }

          const willy_dog = $(`<div class="dogBox" style="top:${top} ; left:${left};"><img src="./image/willy_dog.png" ></div>`)
          $(`#gameBox${gameBoxNumber}_role`).append(willy_dog)
        }





        // 時間到之後
        if (time === 0) {
          clearInterval(begin)
          // 開始鈕樣式復原
          $('#btn').css('backgroundColor', '#ff79a4')
          $('#btn').css('border', '0px')
          $('#btn').css('top', '450px')

          // 開始鈕+地圖選擇器 開
          $(this).attr('disabled', false)
          $('#map_btn_R').attr('disabled', false)
          $('#map_btn_L').attr('disabled', false)

          // 清空遊戲空間 
          $('#gameBox0_role').empty()
          $('#gameBox1_role').empty()
          $('#gameBox2_role').empty()

          // 放回封面圖
          $('#game_img').attr('src', `./image/WhereWilly03.png`)
          $(`#gameBox1_map01`).css('display', 'none')
          $(`#gameBox2_map01`).css('display', 'none')

          // 把版面數字歸零
          $('#score_number').text('00')
          $('#time_number').text('00')



          if (map_btn === 1) {
            if (score > high_map01.score) {
              Swal.fire({
                icon: 'success',
                title: '時間到',
                text: `最高分誕生！你得到${score}分`,
                input: 'text',
                inputAttributes: {
                  required: true
                },
                // 玩家輸入名字
                inputPlaceholder: '請輸入的名字',
                // 驗證錯誤時的文字
                validationMessage: '請輸入的名字',
                allowOutsideClick: false,
                allowEscapeKey: false
              }).then(function (result) {
                console.log(result)
                high_map01.score = score
                high_map01.name = result.value
                $('#highScoreNumber_map01').text(high_map01.score)
                $('#highName_map01').text(high_map01.name)
                localStorage.highest_map01 = JSON.stringify(high_map01)
              })
            } else {
              Swal.fire({
                title: '時間到',
                text: `你得到${score}分`
              })
            }
          }


          if (map_btn === 2) {
            if (score > high_map02.score) {
              Swal.fire({
                icon: 'success',
                title: '時間到',
                text: `最高分誕生！你得到${score}分`,
                input: 'text',
                inputAttributes: {
                  required: true
                },
                // 玩家輸入名字
                inputPlaceholder: '請輸入的名字',
                // 驗證錯誤時的文字
                validationMessage: '請輸入的名字',
                allowOutsideClick: false,
                allowEscapeKey: false
              }).then(function (result) {
                console.log(result)
                high_map02.score = score
                high_map02.name = result.value
                $('#highScoreNumber_map02').text(high_map02.score)
                $('#highName_map02').text(high_map02.name)
                localStorage.highest_map02 = JSON.stringify(high_map02)
              })
            }
            else {
              Swal.fire({
                title: '時間到',
                text: `你得到${score}分`
              })
            }
          }




          if (map_btn === 3) {
            if (score > high_map03.score) {
              Swal.fire({
                icon: 'success',
                title: '時間到',
                text: `最高分誕生！你得到${score}分`,
                input: 'text',
                inputAttributes: {
                  required: true
                },
                // 玩家輸入名字
                inputPlaceholder: '請輸入的名字',
                // 驗證錯誤時的文字
                validationMessage: '請輸入的名字',
                allowOutsideClick: false,
                allowEscapeKey: false
              }).then(function (result) {
                console.log(result)
                high_map03.score = score
                high_map03.name = result.value
                $('#highScoreNumber_map03').text(high_map03.score)
                $('#highName_map03').text(high_map03.name)
                localStorage.highest_map02 = JSON.stringify(high_map03)
              })
            }
            else {
              Swal.fire({
                title: '時間到',
                text: `你得到${score}分`
              })
            }
          }

          // if (score > high.score) {
          //   Swal.fire({
          //     icon: 'success',
          //     title: '時間到',
          //     text: `最高分誕生！你得到${score}分`,
          //     input: 'text',
          //     inputAttributes: {
          //       required: true
          //     },
          //     // 玩家輸入名字
          //     inputPlaceholder: '請輸入的名字',
          //     // 驗證錯誤時的文字
          //     validationMessage: '請輸入的名字',
          //     allowOutsideClick: false,
          //     allowEscapeKey: false
          //   }).then(function (result) {
          //     console.log(result)
          //     high.score = score
          //     high.name = result.value




          //   })
          // }
          // else {
          //   Swal.fire({
          //     title: '時間到',
          //     text: `你得到${score}分`
          //   })
          // }

        }

      }, 1000)
    }, 3000);

  })
  // }

  // 點擊得分


  $('#game').on('click', '.willyBox', function () {
    $(this).stop()
    $(this).removeClass('willyBox').css('display', 'none')
    score++
    $('#score_number').text(score)
  })


  $('#game').on('click', '.womanBox', function () {
    $(this).stop()
    $(this).removeClass('womanBox').css('display', 'none')
    score--
    $('#score_number').text(score)
  })

  $('#game').on('click', '.oldBox', function () {
    $(this).stop()
    $(this).removeClass('oldBox').css('display', 'none')
    score += 5
    $('#score_number').text(score)
  })

  $('#game').on('click', '.dogBox', function () {
    $(this).stop()
    $(this).removeClass('dogBox').css('display', 'none')
    time += 5
    $('#time_number').text(time)
  })



</script>

</html>