<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>威力在哪?(會走的威力)</title>

  <!-- icon CSS -->
  <link rel="stylesheet" href="./CSS/all.min.css">

  <!-- 我的 CSS -->
  <link rel="stylesheet" href="./CSS/style.css">
  <style>
    @font-face {
      font-family: 'Pixel';
      src: url(./CSS/Pixel.ttf);
    }

    @font-face {
      font-family: '俐方體11號';
      src: url(./CSS/Cubic_11_1.010_R.ttf);
    }
  </style>
</head>

<body>

  <div id="content">


    <div id="left">
      <div id="selectMap">選擇地圖</div>

      <div id="map">
        <img src="./image/map01.jpg" id="map_img">
        <input id="map_btn_L" value="←" type="button">
        <input id="map_btn_R" value="→" type="button">
      </div>

      <!-- 開始按鈕 -->
      <input id="btn" type="button" value="Start">

      <!-- <label id="#btn" for="starBtn">
      <div id="btn">Start</div>
    </label> -->

      <!-- <input type="button" id="starBtn"> -->

      <!-- 分數/時間 -->
      <div id="score"> 分　數：<span id="score_number">00</span> 　　分</div>
      <div id="time"> 餘時間：<span id="time_number">00</span> 　　秒</div>
      <!-- 工具 -->
      <div id="tool_content">
        <div class="tool" id="t1"><i class="fa-solid fa-magnifying-glass"></i></div>
        <div class="tool" id="t2"><i class="fa-solid fa-wand-sparkles"></i></div>
        <div class="tool" id="t3"><i class="fa-regular fa-circle-question"></i></div>
      </div>

      <div id="line"></div>
      <!-- 最高分 -->
      <!-- 切換簡單版/困難版的紀錄保持人 -->
      <div id="high">
        <span id="highScore">最高分：<span>00</span> 分 / </span>
        <span id="highName">???</span>
      </div>
    </div>


    <!-- 中間 -->
    <div id="middle_game">
      <!-- 倒數符號 -->
      <div id="number"></div>

      <!-- game_concent 的底圖 -->
      <img src="./image/WhereWilly03.png" id="game_img">
      <!-- <img src="./image/map01.jpg" id="game_img"> -->

      <!-- 遊戲區 -->
      <div id="game">


        <div id="game_willy"></div>

        <div id="gameBox2">
          <!-- map01 -->
          <div id="gameBox2_map01">
            <img src="./image/map01_21.png" id="map01_21_img">
            <img src="./image/map01_22.png" id="map01_22_img">
            <img src="./image/map01_23.png" id="map01_23_img">
            <img src="./image/map01_24.png" id="map01_24_img">
          </div>

          <div id="gameBox2_willy"></div>

          <!-- map02 -->


          <div id="gameBox1">
            <!-- mpa01 -->
            <div id="gameBox1_map01">
              <img src="./image/map01_1.png" id="map01_1_img">
            </div>



            <div id="gameBox1_willy">
              <!-- <img src="./image/Willy_01.png" style="width: 30px; height: 68px; position: absolute; top:calc(92%);
               left: calc(96%);"> -->
            </div>

            <!-- map02 -->

          </div>
        </div>


        <!-- <div class="willyBox"><img src="./image/Willy_02.png"></div> -->
      </div>
    </div>


    <div class="right">
      <div id="title">通緝角色</div>
      <div class="box"><img src="./image/Willy_01.png"></div>
      <div class="box"><img src="./image/Willy_02.png"></div>
      <div class="box"><img src="./image/Willy_03.png"></div>
      <div class="box"><img src="./image/willy_dog.png"></div>
      <!-- <div class="box"></div> -->


    </div>








  </div>
</body>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js'
  integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=='
  crossorigin='anonymous'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.all.min.js'
  integrity='sha512-zB7yJLSASiSevQmWCrQaq+z/f5zRIa884hwWgmK1oI3MfolIzKcpDtyfBsrGqUi/hMCObVwr/+SZTByOqh0zkQ=='
  crossorigin='anonymous'></script>

<script>


  let score = 0
  let time = 0
  let countdown_number = 3
  let high = {
    name: '???',
    score: '00'
  }

  // 把保存在本地端的最高分叫出來
  if (localStorage.highest) {
    const data = JSON.parse(localStorage.highest)
    high.name = data.name
    high.score = data.score
    $('#highName').text(high.name)
    $('#highScore').text(high.score)
  }

  // 選擇地圖
  let map_btn = 1
  $('#map_btn_R').click(function () {
    if (map_btn < 3) {
      map_btn += 1
      $('#map_img').attr('src', `./image/map0${map_btn}.jpg`)
    } else {
      return
    }
  })

  $('#map_btn_L').click(function () {
    if (map_btn > 1) {
      map_btn -= 1
      $('#map_img').attr('src', `./image/map0${map_btn}.jpg`)
    } else {
      return
    }
  })

  // 這邊 個位數 如何置右?

  // function btnBoxClickEvent() {
  $('#btn').click(function () {
    // 初始畫面

    // why label input 無效?
    $(this).attr('disabled', true)



    $('#btn').css('backgroundColor', '#ccc')
    $('#btn').css('border', '3px solid #ddd')
    $('#btn').css('boxShadow', '5px 5px 1.5px #aaa')
    $('#btn').css('top', '458px')

    score = 0
    $('#score_number').text(score)
    time = 30
    $('#time_number').text(time)


    $('#map_btn_R').attr('disabled', true)
    $('#map_btn_L').attr('disabled', true)

    // 開始前3秒


    $('#game_img').attr('src', `./image/WhereWilly04.png`)
    $('#number').css('display', `block`)
    $('#number').css('fontSize', `350px`)
    $('#number').text('3')
    countdown_number = 3


    let countdown = setInterval(function () {
      countdown_number -= 1
      $('#number').text(`${countdown_number}`)
      if (countdown_number === 1) {
        $('#number').css('left', '430px')
      }
    }, 1000)

    setTimeout(() => {
      clearInterval(countdown)
    }, 2000)


    // 3秒後進入遊戲
    setTimeout(() => {
      $('#game_img').attr('src', `./image/map0${map_btn}.jpg`)
      $('#number').css('display', `none`)


      // 設定 willy 隨機出現，若超過 game 範圍則往內
      // 但為什麼百分比老師的不會超過框框?
      let top = Math.round(Math.random() * 100) + '%'
      const overTop = ['93%', '94%', '95%', '96%', '97%', '98%', '99%', '100%']
      let left = Math.round(Math.random() * 100) + '%'
      const overLeft = ['97%', '98%', '99%', '100%']

      if (overTop.includes(top)) {
        top = `calc(${top} - 68px)`
      }
      if (overLeft.includes(left)) {
        left = `calc(${left} - 30px)`
      }

      const willy01_1 = $(`<div class="willyBox" style="top:${top} ; left:${left};"><img src="./image/Willy_01.png" ></div>`)
      $('#gameBox1_willy').append(willy01_1)


      // 開始遊戲 為什麼老師示範是前面變數設為 let timer = 0 ?
      let begin = setInterval(() => {
        // 遊戲空間(待製作)
        time--
        $('#time_number').text(time)


        const random = Math.ceil(Math.random() * 10)

        if (random > 5 && $('.willyBox').length < 5) {
          const willy01 = $(`<div class="willyBox" style="top:${top} ; left:${left};"><img src="./image/Willy_01.png" ></div>`)
          $('#gameBox1_willy').append(willy01)
        }



        // 時間到之後
        if (time === 0) {
          clearInterval(begin)
          // 開始鈕樣式復原
          $('#btn').css('backgroundColor', '#ff79a4')
          $('#btn').css('border', '0px')
          $('#btn').css('boxShadow', '8px 8px 1px #aaa')
          $('#btn').css('top', '460px')

          // 開始鈕+地圖選擇器 開
          $(this).attr('disabled', false)
          $('#map_btn_R').attr('disabled', false)
          $('#map_btn_L').attr('disabled', false)

          // 清空遊戲空間 
          $('#gameBox1_willy').empty()
          // 放回封面圖
          $('#game_img').attr('src', `./image/WhereWilly03.png`)


          if (score > high.score) {
            Swal.fire({
              icon: 'success',
              title: '時間到',
              text: `最高分誕生！你得到${score}分`,
              input: 'text',
              inputAttributes: {
                required: true
              },
              // 玩家輸入名字
              inputPlaceholder: '請輸入的名字',
              // 驗證錯誤時的文字
              validationMessage: '請輸入的名字',
              allowOutsideClick: false,
              allowEscapeKey: false
            }).then(function (result) {
              console.log(result)
              high.score = score
              high.name = result.value
              $('#highScore').text(high.score)
              $('highName').text(high.name)
              localStorage.highest = JSON.stringify(high)
            })
          }
          else {
            Swal.fire({
              title: '時間到',
              text: `你得到${score}分`
            })
          }

        }

      }, 1000)
    }, 3000);

  })
  // }

  // btnBoxClickEvent()

</script>

</html>